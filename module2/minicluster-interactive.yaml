apiVersion: flux-framework.org/v1alpha2
kind: MiniCluster
metadata:
  name: flux-sample
spec:
  # The cluster is interactive, without running a specific command. Tasks does not matter.
  size: 2
  interactive: true
  logging:
    quiet: true

  flux:
    environment:
      LD_LIBRARY_PATH: ""
    container: 
      image: ghcr.io/converged-computing/flux-view-rocky:arm-9
      
  # This container is built for AWS EFA with openmpi 4.1.6 and provided efa/libfabric
  containers:   
   - image: ghcr.io/converged-computing/lammps-reax-efa:ubuntu2404-efa

     # This is more expert optimization to ensure /dev/shm does not limit efa
     volumes:
        shared-memory:
          emptyDir: true
          emptyDirMedium: "memory"

     # Ensure we get a single EFA device
     resources:
       limits:
         vpc.amazonaws.com/efa: 1
       requests:
         vpc.amazonaws.com/efa: 1
